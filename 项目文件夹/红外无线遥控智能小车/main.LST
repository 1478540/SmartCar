C51 COMPILER V9.54   MAIN                                                                  10/13/2023 10:22:55 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\MyProgramFile\Keil_C51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2
                    -)

line level    source

   1          #include <reg52.h> //51ͷļ
   2          #include "QXA51.h"//QX-A51Сļ
   3          
   4          
   5          
   6          /*====================================
   7           Ӳӿλ
   8          ====================================*/
   9          sbit IR  = P3^2;     //ݽӿ ⲿжO
  10          
  11          unsigned char IRtime;     //ߵƽʱ䣨
  12          unsigned char IRcord[4];    //ڴ4ֽڵݣû2ֽ+ֵ2ֽڣ
  13          unsigned char IRdata[33];   //ڴ33λݣһλΪû16+ֵ16
  14          bit IRpro_ok, IRok;  //һں4ֽϡIRokΪ
  15          
  16          void init()    //ʼʱ0 ⲿж0
  17          {
  18   1        TMOD = 0x02; //ʱ0ʽ28λԶװ
  19   1        TH0 = 0x00;  //8λװ0ôʱһεʱ256
  20   1        TL0 = 0x00;
  21   1        EA = 1;      //ж
  22   1        ET0 = 1;     //ʱ0ж
  23   1        TR0 = 1;     //ʱ0
  24   1      
  25   1        IT0 = 1;     //ⲿж0Ϊشʽһ½شһ
  26   1        EX0 = 1;     //ⲿж0
  27   1      }
  28          
  29          void time0() interrupt 1   //嶨ʱ0
  30          {
  31   1        IRtime++;          //1Ϊ278us
  32   1      }
  33          
  34          void int0() interrupt 0       //ⲿж0
  35          {
  36   1        static unsigned char i;       //  ̬ڻִеʱ򲻻ᶪʧֵiڰ33θߵƽ
             -ĳʱIRdata
  37   1        static bit startflag;   //ʼ־λ
  38   1        if(startflag)       //ʼ
  39   1        {
  40   2          if( (IRtime < 53) && (IRtime >= 32) ) /*жǷ룬׵ƽ9000us+4500us 
  41   2          Լ11.0592NECЭ8000-10000+4000-5000 
  42   2          Ѿôiᱻ0ͻῪʼδ*/
  43   2            i = 0;         //ôִi=0浽IRdataĵһλ
  44   2          IRdata[i] = IRtime;      //T0ʱ浽浽ж
  45   2          IRtime = 0;        //㣬һ½صʱڴ
  46   2          i++;           //Ĵ
  47   2          if(i == 33)          //34 ±Ǵ0ʼi33ʾִ34
  48   2          {
  49   3            IRok = 1;        //ôʾ
  50   3            i = 0;         //׼´δ
  51   3          }
  52   2        }
  53   1        else      
C51 COMPILER V9.54   MAIN                                                                  10/13/2023 10:22:55 PAGE 2   

  54   1        {
  55   2          IRtime = 0;          //뿪ʼ㿪ʼ
  56   2          startflag = 1;       //ʼ־λ1
  57   2        }
  58   1      }
  59          
  60          void IRcordpro()           //ȡ33ݽ
  61          {
  62   1        unsigned char i, j, k, cord, value; /*iڴ4ֽڣjڴһֽÿһλk33еһ
             -
  63   1        cordȡʱжǷ1ʱ*/
  64   1        k = 1;            //ӵһλʼȡ
  65   1        for(i = 0; i < 4; i++)
  66   1        {
  67   2          for(j = 0; j < 8; j++)
  68   2          {
  69   3            cord = IRdata[k];     //cord
  70   3            if(cord > 5)      //11.0592t0ΪԼ278us*5=1390ôжΪ1
  71   3            value = value | 0x80; /*յʱȽλ
  72   3            λȷŵvalueλں0x08λһ
  73   3            ıvaluaλֵֻλΪ1*/
  74   3            if(j < 7)
  75   3            {
  76   4              value = value >> 1; //valueλν8λݡ
  77   4            }
  78   3            k++;        //ÿִһλ1
  79   3          }
  80   2          IRcord[i] = value;     //ÿһֽڰIRcordС
  81   2          value = 0;         //value´ڴ
  82   2        }
  83   1        IRpro_ok = 1;          //4ֽںIRpro ok1ʾ 
  84   1      }
  85          /*PWMʹ Сǰ*/
  86          void forward()
  87          {
  88   1        left_motor_go; //ǰ
  89   1        right_motor_go; //ҵǰ
  90   1      }
  91          
  92            
  93          /*PWMʹ С*/
  94          void backward()
  95          {
  96   1        left_motor_back; //
  97   1        right_motor_back; //ҵ  
  98   1      }
  99          
 100          
 101          /*PWMʹ Сת*/
 102          void left_run()
 103          {
 104   1        left_motor_stop; //ֹͣ
 105   1        right_motor_go; //ҵǰ  
 106   1      }
 107          
 108          
 109          /*PWMʹ Сת*/
 110          void right_run()
 111          {
 112   1        right_motor_stop;//ҵֹͣ
 113   1        left_motor_go;    //ǰ
 114   1      }
C51 COMPILER V9.54   MAIN                                                                  10/13/2023 10:22:55 PAGE 3   

 115          
 116          
 117          /*Сֹͣ*/
 118          void stop()
 119          {
 120   1        right_motor_stop;//ҵֹͣ
 121   1        left_motor_stop; //ֹͣ 
 122   1      }
 123          
 124          void main()
 125          {
 126   1        init(); //ִгʼʱ0ⲿж0
 127   1        EN1 = EN2 = 1;//ʹҵ
 128   1        while(1)  //ѭ
 129   1        {
 130   2          if(IRok)    //жǷ                    
 131   2          {   
 132   3            IRcordpro();//4ֽڵ
 133   3            IRok = 0; //µȴ
 134   3            if(IRpro_ok) //жǷ  
 135   3            {
 136   4                  switch(IRcord[2])
 137   4                {
 138   5                   case 0x18:  forward();        //ǰ
 139   5                           break;
 140   5                   case 0x52:  backward();         //  
 141   5                           break;
 142   5                   case 0x08:  left_run();       //ת
 143   5                           break;
 144   5                 case 0x5A:  right_run();        //ת
 145   5                           break;
 146   5                 case 0x1C:  stop();           //ֹͣ
 147   5                           break;
 148   5                 default:break;
 149   5                }
 150   4              IRpro_ok = 0;
 151   4            }
 152   3          } 
 153   2        }
 154   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    248    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     39    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
